
#Run example, including placeholder substitution:
#  cat k8s/payment-service-deployment.yaml \
#  | sed  " \
#  s/__ENVIRONMENT/ci/g; \
#  s/__ROLE/web/g; \
#  s/__DEBUG/False/g; \
#  s/__REPLICAS/1/g; \
#  s/__VERSION/1.0/g" \
#  | kubectl apply  -f -

#TODO: add resources (CPU/Memory) limitations

apiVersion: apps/v1
kind: Deployment

metadata:
  annotations:
        iam.amazonaws.com/role: ci-payment-service
  labels:
    app: payment-__ROLE
  name: payment-__ROLE
  namespace: __ENVIRONMENT
spec:
  replicas: __REPLICAS
  selector:
    matchLabels:
      app: payment-__ROLE
  template:
    metadata:
      labels:
        app: payment-__ROLE
        name: payment-__ROLE
        version: "__VERSION"
    spec:
      restartPolicy: Always
      containers:
        - command:  [ "/bin/sh" ]
          args: [ "-c",  "./config/startup.sh" ]
          image: kinecosystem/payment-service-ittiel:__VERSION
          name: payment-__ROLE
          ports:
          - containerPort: 3000
          env:
            - name: ENVIRONMENT
              value: "__ENVIRONMENT"
            - name: ROLE
              value: "__ROLE"
            - name: DEBUG
              value: "__DEBUG"
